<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
  fill: #fafafa;
  stroke: #aaa;
}

.cut {
  stroke-width: 2px;
  stroke-dasharray: 5,5;
  stroke: #000;
}

.left {
  fill: #EB9394;
}

.right {
  fill: #8FBBDA;
}

</style>
<body>
<script src="../node_modules/d3-polygon/build/d3-polygon.js"></script>
<script src="../build/partials.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script><script>

var width = 960,
    height = 500,
    N = 25,
    triangles,
    polgyons;

var vertices = d3.range(N).map(function(d) {
  return [Math.random() * width, Math.random() * height];
});

var segment = [[50, 50], vertices[N - 1]];

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .on("mousemove", function() { segment[0] = d3.mouse(this); redraw(); });

redraw();

function redraw() {
  d3.selectAll("path").remove();

  var path = svg.selectAll(".base");

  var overlay = svg.selectAll(".overlay");

  triangles = d3.geom.delaunay(vertices);
  polygons = partials.cutCollection(segment[0], segment[1], triangles);

  polygons = polygons.filter(function(d) {
    return !triangles.includes(d);
  });

  triangles = triangles.filter(function(d) {
    return !polygons.includes(d);
  });

  path = path.data(triangles.map(function(d) { return "M" + d.join("L") + "Z"; }), String);
  path.enter().append("path")
    .attr("d", String);

  overlay = overlay.data(polygons.map(function(d) { return "M" + d.join("L") + "Z"; }), String);
  overlay.enter().append("path").attr("class", function(d, i) { return (i % 2 == 0) ? "left" : "right"; })
    .attr("d", String);

 var cut = svg.append("path")
          .datum(segment)
          .attr("class", "cut")
          .attr("d", d3.svg.line());
}

</script>